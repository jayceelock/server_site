# Create your views here.

from Crypto.PublicKey import RSA
from Crypto import Random
from django.http import HttpResponse
import html2text
from urllib import *

def generate_key():
	global private_key
	global url_key
	global enc_data

	data = 'blabla'
	
	random_generator = Random.new().read

	private_key = RSA.generate(1024, random_generator)
	public_key = private_key.publickey()
	
	file = open("keys.priv", "w")
	file.write(key.exportKey())
	file.close()

	url_key = private_key.exportKey().split("-----", 4)
	
	enc_data = public_key.encrypt(data, 32)

def display_public_key(request):
	#return HttpResponse(key.publickey())
	return HttpResponse("<p>-----" + url_key[1] + "-----<br>" + url_key[2] + "<br>-----" + url_key[3] + "-----</p>")
	#return HttpResponse(url_key[3])

def test(request):
	html = urlopen("http://127.0.0.1:8000/public_key/").read()
	#file = open("keys.txt")
	#privatestr = file.read()
	#file.close()
	privatestr = html2text.html2text(html)
	key2 = RSA.importKey(privatestr)
	data = key2.decrypt(enc_data)
	return HttpResponse(data)
